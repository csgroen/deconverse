<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="deconverse">
<title>Benchmarking example with pancreatic cancer data • deconverse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking example with pancreatic cancer data">
<meta property="og:description" content="deconverse">
<meta property="og:image" content="https://csgroen.github.io/deconverse/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">deconverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.6.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro_pbmc.html">Introduction: full explained deconverse pipeline with PBMCs</a>
    <a class="dropdown-item" href="../articles/pdac_tutorial.html">Benchmarking example with pancreatic cancer data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Benchmarking example with pancreatic cancer data</h1>
                        <h4 data-toc-skip class="author">Clarice S.
Groeneveld</h4>
            
      
      
      <div class="d-none name"><code>pdac_tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="context">Context<a class="anchor" aria-label="anchor" href="#context"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">deconverse</span><span class="op">)</span></span></code></pre></div>
<p>We’ll use example data from pancreatic cancer and multiple datasets,
annotated with more or less the same categories to challenge some of the
methods implemented in the <code>deconverse</code> package.</p>
</div>
<div class="section level2">
<h2 id="example-reference-dataset-cra001160">Example reference dataset: CRA001160<a class="anchor" aria-label="anchor" href="#example-reference-dataset-cra001160"></a>
</h2>
<p>We chose two pancreatic adenocarcinoma single-cell datasets to be
reference and test dataset examples. CRA001160, the biggest dataset,
will be used to train the references.</p>
<div class="section level3">
<h3 id="download">Download<a class="anchor" aria-label="anchor" href="#download"></a>
</h3>
<p>First, we need to download the expression data and cell metadata from
the repository.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">download_file</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">link</span>, <span class="va">fname</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">old_timeout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">'timeout'</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout<span class="op">=</span><span class="fl">1e6</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Downloading data..."</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">link</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout<span class="op">=</span><span class="va">old_timeout</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"File "</span>, <span class="va">fname</span>, <span class="st">" found, skipping download..."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Source: http://tisch.comp-genomics.org/gallery/?cancer=PAAD&amp;celltype=&amp;species=</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data"</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">download_file</span><span class="op">(</span><span class="st">"https://biostorage.s3.ap-northeast-2.amazonaws.com/TISCH_2022/PAAD_CRA001160/PAAD_CRA001160_expression.h5"</span>,</span>
<span>              <span class="st">"data/PAAD_CRA001160_expression.h5"</span><span class="op">)</span></span>
<span><span class="fu">download_file</span><span class="op">(</span><span class="st">"http://tisch.comp-genomics.org/static/data/PAAD_CRA001160/PAAD_CRA001160_CellMetainfo_table.tsv"</span>,</span>
<span>              <span class="st">"data/PAAD_CRA001160_CellMetainfo_table.tsv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-data">Read data<a class="anchor" aria-label="anchor" href="#read-data"></a>
</h3>
<p>Now, we can read these objects into R and create a Seurat object. The
cells in this dataset have already been through quality control
steps.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">sc_paad_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/Read10X_h5.html" class="external-link">Read10X_h5</a></span><span class="op">(</span><span class="st">"data/PAAD_CRA001160_expression.h5"</span>, use.names <span class="op">=</span> <span class="cn">TRUE</span>, unique.features <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sc_paad_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="st">"data/PAAD_CRA001160_CellMetainfo_table.tsv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_paad_meta</span> <span class="op">&lt;-</span> <span class="va">sc_paad_meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">" |\\-|\\_"</span>, <span class="st">"."</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="st">"\\(|\\)"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span><span class="st">"Cell"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sc_paad_mat</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_paad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">sc_paad_mat</span>, project <span class="op">=</span> <span class="st">"PAAD"</span>, </span>
<span>                              meta.data <span class="op">=</span> <span class="va">sc_paad_meta</span><span class="op">)</span></span>
<span><span class="va">so_paad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">so_paad</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">sc_paad_mat</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             used   (Mb) gc trigger   (Mb)   max used   (Mb)</span></span>
<span><span class="co">## Ncells  10537483  562.8   15974001  853.2   15974001  853.2</span></span>
<span><span class="co">## Vcells 446712991 3408.2 1155934628 8819.1 1019764583 7780.2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="visualize-annotations">Visualize annotations<a class="anchor" aria-label="anchor" href="#visualize-annotations"></a>
</h3>
<p>We can visualize the provided annotations using the Seurat object.
Cell identities are provided at 3 levels of hierarchy:
<code>"Celltype.malignancy"</code>,
<code>"Celltype.major.lineage"</code> and
<code>"Celltype.minor.lineage"</code> .</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">plt_paad_umap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">so</span>, <span class="va">color_var</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">so</span><span class="op">@</span><span class="va">meta.data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">UMAP.1</span>, <span class="va">UMAP.2</span>, color <span class="op">=</span> <span class="op">!</span><span class="op">!</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html" class="external-link">sym</a></span><span class="op">(</span><span class="va">color_var</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">color_var</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">annot1</span> <span class="op">&lt;-</span> <span class="fu">plt_paad_umap</span><span class="op">(</span><span class="va">so_paad</span>, <span class="st">"Celltype.malignancy"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span><span class="op">)</span></span>
<span><span class="va">annot2</span> <span class="op">&lt;-</span> <span class="fu">plt_paad_umap</span><span class="op">(</span><span class="va">so_paad</span>, <span class="st">"Celltype.major.lineage"</span><span class="op">)</span></span>
<span><span class="va">annot3</span> <span class="op">&lt;-</span> <span class="fu">plt_paad_umap</span><span class="op">(</span><span class="va">so_paad</span>, <span class="st">"Celltype.minor.lineage"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="op">(</span><span class="va">annot1</span> <span class="op">|</span> <span class="va">annot2</span> <span class="op">|</span> <span class="va">annot3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-7-1.png" width="1152"></p>
<p>We can visualize how the cell annotations map between different
levels of hierarchy:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Celltype.malignancy</span>, <span class="va">Celltype.major.lineage</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                    Celltype.major.lineage</span></span>
<span><span class="co">## Celltype.malignancy Acinar     B CD8Tex    DC Ductal Endocrine Endothelial</span></span>
<span><span class="co">##     Immune cells         0  1137   4572  2139      0         0           0</span></span>
<span><span class="co">##     Malignant cells      0     0      0     0      0         0           0</span></span>
<span><span class="co">##     Others            2018     0      0     0  10205       620           0</span></span>
<span><span class="co">##     Stromal cells        0     0      0     0      0         0        9106</span></span>
<span><span class="co">##                    Celltype.major.lineage</span></span>
<span><span class="co">## Celltype.malignancy Fibroblasts Malignant Mono/Macro Plasma Stellate</span></span>
<span><span class="co">##     Immune cells              0         0       3327    479        0</span></span>
<span><span class="co">##     Malignant cells           0     11401          0      0        0</span></span>
<span><span class="co">##     Others                    0         0          0      0     5265</span></span>
<span><span class="co">##     Stromal cells          7174         0          0      0        0</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Celltype.major.lineage</span>, <span class="va">Celltype.minor.lineage</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                       Celltype.minor.lineage</span></span>
<span><span class="co">## Celltype.major.lineage Acinar     B CD8Tex Ductal Endocrine Endothelial</span></span>
<span><span class="co">##            Acinar        2018     0      0      0         0           0</span></span>
<span><span class="co">##            B                0  1137      0      0         0           0</span></span>
<span><span class="co">##            CD8Tex           0     0   4572      0         0           0</span></span>
<span><span class="co">##            DC               0     0      0      0         0           0</span></span>
<span><span class="co">##            Ductal           0     0      0  10205         0           0</span></span>
<span><span class="co">##            Endocrine        0     0      0      0       620           0</span></span>
<span><span class="co">##            Endothelial      0     0      0      0         0        9106</span></span>
<span><span class="co">##            Fibroblasts      0     0      0      0         0           0</span></span>
<span><span class="co">##            Malignant        0     0      0      0         0           0</span></span>
<span><span class="co">##            Mono/Macro       0     0      0      0         0           0</span></span>
<span><span class="co">##            Plasma           0     0      0      0         0           0</span></span>
<span><span class="co">##            Stellate         0     0      0      0         0           0</span></span>
<span><span class="co">##                       Celltype.minor.lineage</span></span>
<span><span class="co">## Celltype.major.lineage Fibroblasts    M1 Malignant Monocyte   pDC Plasma</span></span>
<span><span class="co">##            Acinar                0     0         0        0     0      0</span></span>
<span><span class="co">##            B                     0     0         0        0     0      0</span></span>
<span><span class="co">##            CD8Tex                0     0         0        0     0      0</span></span>
<span><span class="co">##            DC                    0     0         0        0  2139      0</span></span>
<span><span class="co">##            Ductal                0     0         0        0     0      0</span></span>
<span><span class="co">##            Endocrine             0     0         0        0     0      0</span></span>
<span><span class="co">##            Endothelial           0     0         0        0     0      0</span></span>
<span><span class="co">##            Fibroblasts        7174     0         0        0     0      0</span></span>
<span><span class="co">##            Malignant             0     0     11401        0     0      0</span></span>
<span><span class="co">##            Mono/Macro            0   393         0     2934     0      0</span></span>
<span><span class="co">##            Plasma                0     0         0        0     0    479</span></span>
<span><span class="co">##            Stellate              0     0         0        0     0      0</span></span>
<span><span class="co">##                       Celltype.minor.lineage</span></span>
<span><span class="co">## Celltype.major.lineage Stellate</span></span>
<span><span class="co">##            Acinar             0</span></span>
<span><span class="co">##            B                  0</span></span>
<span><span class="co">##            CD8Tex             0</span></span>
<span><span class="co">##            DC                 0</span></span>
<span><span class="co">##            Ductal             0</span></span>
<span><span class="co">##            Endocrine          0</span></span>
<span><span class="co">##            Endothelial        0</span></span>
<span><span class="co">##            Fibroblasts        0</span></span>
<span><span class="co">##            Malignant          0</span></span>
<span><span class="co">##            Mono/Macro         0</span></span>
<span><span class="co">##            Plasma             0</span></span>
<span><span class="co">##            Stellate        5265</span></span></code></pre>
<p>We also fix names might pose problems in downstream analyses, either
because they differ between datasets (<code>CD8Tex</code> instead of
just <code>CD8T</code>) or because they contain special characters that
can generate problems in formulas (like <code>Mono/Macro</code>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.major.lineage</span><span class="op">[</span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.major.lineage</span> <span class="op">==</span> <span class="st">"Mono/Macro"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Mono_Macro"</span></span>
<span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.major.lineage</span><span class="op">[</span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.major.lineage</span> <span class="op">==</span> <span class="st">"CD8Tex"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD8T"</span></span>
<span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.minor.lineage</span><span class="op">[</span><span class="va">so_paad</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.minor.lineage</span> <span class="op">==</span> <span class="st">"CD8Tex"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD8T"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-hscreference-with-deconverse">Create <code>hscreference</code> with <code>deconverse</code><a class="anchor" aria-label="anchor" href="#create-hscreference-with-deconverse"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paad_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_screference.html">new_screference</a></span><span class="op">(</span><span class="va">so_paad</span>, </span>
<span>                               project_name <span class="op">=</span> <span class="st">"paad_example"</span>,</span>
<span>                               annot_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Celltype.malignancy"</span>, <span class="st">"Celltype.major.lineage"</span>, <span class="st">"Celltype.minor.lineage"</span><span class="op">)</span>,</span>
<span>                               batch_id <span class="op">=</span> <span class="st">"Patient"</span>,</span>
<span>                               seed <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compute-references-for-different-methods">Compute references for different methods<a class="anchor" aria-label="anchor" href="#compute-references-for-different-methods"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paad_ref</span> <span class="op">&lt;-</span> <span class="va">paad_ref</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">compute_reference</span><span class="op">(</span><span class="st">"dwls"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">compute_reference</span><span class="op">(</span><span class="st">"autogenes"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-benchmarking-dataset-gse154778">Example benchmarking dataset: GSE154778<a class="anchor" aria-label="anchor" href="#example-benchmarking-dataset-gse154778"></a>
</h2>
<p>We’ll use a different single-cell dataset with similar annotations to
benchmark the dataset. This dataset doesn’t feature all the cell types
in the reference, so the benchmark will be limited to cell types present
in the test dataset. However, because the reference also contains other
cell types, we will also get to see how the methods perform when there
are confounding cell types in the reference.</p>
<p><strong>We’re still working on:</strong> (1) adding confounding cell
types to the mixture that are not present in the reference and then
assessing the behavior of different methods; (2) effectively evaluating
the performance of methods when there are more cell types in the
reference than in the benchmarking mixture.</p>
<p>Case (2) is allowed by scbench currently, but case (1) is not
i.e. all cells types in the benchmark must be in the reference.</p>
<div class="section level3">
<h3 id="download-1">Download<a class="anchor" aria-label="anchor" href="#download-1"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download_file</span><span class="op">(</span><span class="st">"https://biostorage.s3.ap-northeast-2.amazonaws.com/TISCH_2022/PAAD_GSE141017/PAAD_GSE141017_expression.h5"</span>,</span>
<span>              <span class="st">"data/PAAD_GSE141017_expression.h5"</span><span class="op">)</span></span>
<span><span class="fu">download_file</span><span class="op">(</span><span class="st">"http://tisch.comp-genomics.org/static/data/PAAD_GSE141017/PAAD_GSE141017_CellMetainfo_table.tsv"</span>,</span>
<span>              <span class="st">"data/PAAD_GSE141017_CellMetainfo_table.tsv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-data-1">Read data<a class="anchor" aria-label="anchor" href="#read-data-1"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">sc_paad_mat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/Read10X_h5.html" class="external-link">Read10X_h5</a></span><span class="op">(</span><span class="st">"data/PAAD_GSE141017_expression.h5"</span>, use.names <span class="op">=</span> <span class="cn">TRUE</span>, unique.features <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sc_paad_meta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="st">"data/PAAD_GSE141017_CellMetainfo_table.tsv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_paad_meta2</span> <span class="op">&lt;-</span> <span class="va">sc_paad_meta2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">" |\\-|\\_"</span>, <span class="st">"."</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="st">"\\(|\\)"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span><span class="st">"Cell"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sc_paad_mat2</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_paad2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">sc_paad_mat2</span>, project <span class="op">=</span> <span class="st">"PAAD_bench"</span>, </span>
<span>                              meta.data <span class="op">=</span> <span class="va">sc_paad_meta2</span><span class="op">)</span></span>
<span><span class="va">so_paad2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">so_paad2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-populations">Visualize populations<a class="anchor" aria-label="anchor" href="#visualize-populations"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">annot1</span> <span class="op">&lt;-</span> <span class="fu">plt_paad_umap</span><span class="op">(</span><span class="va">so_paad2</span>, <span class="st">"Celltype.malignancy"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"qual"</span><span class="op">)</span></span>
<span><span class="va">annot2</span> <span class="op">&lt;-</span> <span class="fu">plt_paad_umap</span><span class="op">(</span><span class="va">so_paad2</span>, <span class="st">"Celltype.major.lineage"</span><span class="op">)</span></span>
<span><span class="va">annot3</span> <span class="op">&lt;-</span> <span class="fu">plt_paad_umap</span><span class="op">(</span><span class="va">so_paad2</span>, <span class="st">"Celltype.minor.lineage"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="op">(</span><span class="va">annot1</span> <span class="op">|</span> <span class="va">annot2</span> <span class="op">|</span> <span class="va">annot3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="1152"></p>
<p>We see fewer populations in this test set than in the reference
dataset. Some have slightly different names such as “CD8Tcm”, so we’ll
fix this:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">so_paad2</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.minor.lineage</span><span class="op">[</span><span class="va">so_paad2</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.minor.lineage</span> <span class="op">==</span> <span class="st">"CD8Tcm"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD8T"</span></span>
<span><span class="va">so_paad2</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.major.lineage</span><span class="op">[</span><span class="va">so_paad2</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Celltype.major.lineage</span> <span class="op">==</span> <span class="st">"Mono/Macro"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Mono_Macro"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-scbench">Create <code>scbench</code><a class="anchor" aria-label="anchor" href="#create-scbench"></a>
</h3>
<p>As PDACs are tumors with low cellularity, we generate mixtures with
varying levels of cellularity (10-60%) and high stromal content.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paad_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  l1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Malignant cells"</span>, <span class="st">"Immune cells"</span>, <span class="st">"Stromal cells"</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.2</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  `l2_Immune cells` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD8T"</span>, <span class="st">"Mono_Macro"</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  `l3_Mono_Macro` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M1"</span>, <span class="st">"Monocyte"</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paad_bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_scbench.html">new_scbench</a></span><span class="op">(</span><span class="va">so_paad2</span>,</span>
<span>                          annot_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Celltype.malignancy"</span>, <span class="st">"Celltype.major.lineage"</span>, <span class="st">"Celltype.minor.lineage"</span><span class="op">)</span>,</span>
<span>                          pop_bounds <span class="op">=</span> <span class="va">paad_bounds</span>,</span>
<span>                          project_name <span class="op">=</span> <span class="st">"paad_example"</span>,</span>
<span>                          batch_id <span class="op">=</span> <span class="st">"Patient"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmark">Benchmark<a class="anchor" aria-label="anchor" href="#benchmark"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paad_bench</span> <span class="op">&lt;-</span> <span class="va">paad_bench</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mixtures_population.html">mixtures_population</a></span><span class="op">(</span>nsamps <span class="op">=</span> <span class="fl">500</span>, seed <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mixtures_spillover.html">mixtures_spillover</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mixtures_lod.html">mixtures_lod</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">paad_bench</span> <span class="op">&lt;-</span> <span class="va">paad_bench</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pseudobulks.html">pseudobulks</a></span><span class="op">(</span>ncells <span class="op">=</span> <span class="fl">1000</span>, seed <span class="op">=</span> <span class="fl">0</span>, ncores <span class="op">=</span> <span class="fl">8</span>, by_batch <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">deconvolute_all</span><span class="op">(</span><span class="va">paad_ref</span>, methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dwls"</span>, <span class="st">"svr"</span>, <span class="st">"ols"</span>, <span class="st">"autogenes"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-results">Plot results<a class="anchor" aria-label="anchor" href="#plot-results"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plt_cor_heatmap.html">plt_cor_heatmap</a></span><span class="op">(</span><span class="va">paad_bench</span><span class="op">)</span><span class="op">$</span><span class="va">heatmap</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-24-1.png" width="432"></p>
<p>AutoGeneS is the only method capable of detecting M1 macrophages. As
SVR, DWLS and OLS use the same reference, this problem probably comes
from the inability of DWLS to find specific M1 markers.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plt_cors_scatter.html">plt_cors_scatter</a></span><span class="op">(</span><span class="va">paad_bench</span>, method <span class="op">=</span> <span class="st">"autogenes"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-25-1.png" width="480"></p>
<p>In spite of that, SVR still has the overall smallest estimation
error:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plt_rmse_heatmap.html">plt_rmse_heatmap</a></span><span class="op">(</span><span class="va">paad_bench</span><span class="op">)</span><span class="op">$</span><span class="va">heatmap</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-26-1.png" width="528"></p>
<p>DWLS has the best spillover performance and only fails significantly
when assessing M1 vs Monocytes.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plt_spillover_heatmap.html">plt_spillover_heatmap</a></span><span class="op">(</span><span class="va">paad_bench</span><span class="op">)</span><span class="op">$</span><span class="va">heatmap</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-27-1.png" width="480"></p>
<p>OLS has the lowest limits of detection, with the exception of M1 vs
Monocytes, where it fails.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plt_lod_heatmap.html">plt_lod_heatmap</a></span><span class="op">(</span><span class="va">paad_bench</span><span class="op">)</span><span class="op">$</span><span class="va">heatmap</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-28-1.png" width="480"></p>
<p>If we consider it at the l2 level (where Monocytes and Macrophages
are grouped together), AutoGeneS has the lowest limits of detection</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plt_lod_heatmap.html">plt_lod_heatmap</a></span><span class="op">(</span><span class="va">paad_bench</span>, level <span class="op">=</span> <span class="st">"l2"</span><span class="op">)</span><span class="op">$</span><span class="va">heatmap</span></span></code></pre></div>
<p><img src="pdac_tutorial_files/figure-html/unnamed-chunk-29-1.png" width="480">
In conclusion, AutogeneS is the only method tested here capable of
distinguishing M1 from other Monocytes/Macrophages, but otherwise is not
the the least error prone for other populations.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Clarice S Groeneveld.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
